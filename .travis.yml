language: ruby
rvm:
  - 2.5
jobs:
  include:
    - stage: test
      install:
        - gem install bundler
        - bundle install --jobs=3 --retry=3
      script:
        - jekyll build
    - stage: deploy
      if: branch = release
      install:
        - gem install bundler
        - bundle install --jobs=3 --retry=3
        - nvm install 8.12 && nvm use 8.12
        - npm install -g firebase-tools
      script:
        - jekyll build
        - firebase deploy --token $FIREBASE_TOKEN
branches:
  only:
    - release
    - master
